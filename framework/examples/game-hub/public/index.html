<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game Hub</title>
    <meta
      name="description"
      content="Unified Game Hub: Farm, Trivia (Solo &amp; Duel), Match-3 with Leaderboard â€” Discord Activities Framework Demo"
    />
    <link rel="stylesheet" href="css/base.css?v=4.11" />
    <link rel="stylesheet" href="css/farm.css?v=4.11" />
    <link rel="stylesheet" href="css/trivia.css?v=4.11" />
    <link rel="stylesheet" href="css/match3.css?v=4.11" />
    <link rel="stylesheet" href="css/blox.css?v=4.11" />
    <link rel="stylesheet" href="css/hud.css?v=4.11" />
    <link rel="stylesheet" href="css/pet.css?v=4.11" />
  </head>
  <body>
    <!-- â•â•â• Boot Loading Overlay â•â•â• -->
    <div class="boot-loader" id="boot-loader">
      <div class="boot-spinner"></div>
      <div class="boot-text">Loading Game Hubâ€¦</div>
    </div>

    <!-- â•â•â• Nav Dots (desktop only fallback) â•â•â• -->
    <div class="nav-dots">
      <button class="nav-dot" id="nav-dot-trivia" title="Trivia"></button>
      <button class="nav-dot" id="nav-dot-blox" title="Building Blox"></button>
      <button class="nav-dot active" id="nav-dot-farm" title="Farm"></button>
      <button class="nav-dot" id="nav-dot-match3" title="Match-3"></button>
    </div>
    <!-- â•â•â• Mobile Bottom Nav Bar â•â•â• -->
    <nav class="nav-bar" id="nav-bar">
      <button class="nav-tab" id="nav-tab-trivia" data-screen="0">
        <span class="nav-tab-icon">ğŸ§ </span>
        <span class="nav-tab-label">Trivia</span>
      </button>
      <button class="nav-tab" id="nav-tab-blox" data-screen="1">
        <span class="nav-tab-icon">ğŸ§±</span>
        <span class="nav-tab-label">Blox</span>
      </button>
      <button class="nav-tab active" id="nav-tab-farm" data-screen="2">
        <span class="nav-tab-icon">ğŸŒ±</span>
        <span class="nav-tab-label">Farm</span>
      </button>
      <button class="nav-tab" id="nav-tab-match3" data-screen="3">
        <span class="nav-tab-icon">ğŸ’</span>
        <span class="nav-tab-label">Match-3</span>
      </button>
    </nav>
    <!-- Farm ready badge (Issue 7) -->
    <span class="farm-ready-badge" id="farm-ready-badge"></span>

    <!-- â•â•â• TopHUD â€” Energy & Gold â•â•â• -->
    <div class="top-hud" id="top-hud">
      <div class="hud-energy" id="hud-energy">
        <!-- Bug 7: regen fill behind content, fills entire energy pill -->
        <div
          class="hud-energy-regen-fill"
          id="hud-energy-regen-fill"
          style="width: 0%"
        ></div>
        <span class="hud-icon">âš¡</span>
        <span id="hud-energy-text">--/--</span>
        <div class="hud-energy-tooltip" id="hud-energy-tooltip">Loading...</div>
      </div>
      <div class="hud-gold" id="hud-gold">
        <span class="hud-icon">ğŸª™</span>
        <span id="hud-gold-text">--</span>
      </div>
      <button class="econ-guide-btn" id="econ-guide-btn" title="Economy Guide">
        ?
      </button>
    </div>

    <!-- â•â•â• 7.1: Farm Shop FAB â•â•â• -->
    <button class="farm-shop-fab" id="farm-shop-fab" title="Open Shop">
      ğŸ›’
    </button>

    <!-- â•â•â• 7.7: Economy Guide Overlay â•â•â• -->
    <div class="econ-guide-overlay" id="econ-guide-overlay">
      <div class="econ-guide-card">
        <h3>ğŸ’° Economy Flow</h3>
        <div class="econ-guide-flow">
          <div class="econ-step">âš¡ Energy â†’ Play Games</div>
          <div class="econ-arrow">â†“</div>
          <div class="econ-step">ğŸ’ Score Points â†’ Earn ğŸª™ Gold</div>
          <div class="econ-arrow">â†“</div>
          <div class="econ-step">ğŸª™ Gold â†’ Buy ğŸŒ¾ Seeds</div>
          <div class="econ-arrow">â†“</div>
          <div class="econ-step">ğŸŒ± Plant & Harvest Crops</div>
          <div class="econ-arrow">â†“</div>
          <div class="econ-step">ğŸ¥• Feed Pet â†’ Restore âš¡ Energy</div>
        </div>
        <button class="btn btn-secondary btn-sm" id="econ-guide-close">
          Got it!
        </button>
      </div>
    </div>

    <!-- â•â•â• Viewport â•â•â• -->
    <div class="viewport">
      <div class="screen-track" id="track">
        <!-- â”€â”€â”€â”€â”€â”€ TRIVIA SCREEN â”€â”€â”€â”€â”€â”€ -->
        <section class="screen" id="screen-trivia">
          <div class="screen-header">
            <h1>ğŸ§  Brain Blitz</h1>
            <div class="subtitle">Trivia â€” Solo & Duel</div>
          </div>

          <!-- Menu -->
          <div id="trivia-menu" class="card">
            <div class="trivia-modes">
              <button class="trivia-mode-btn" id="btn-trivia-solo">
                <span class="mode-icon">ğŸ¯</span>
                <span class="mode-label">Solo</span>
                <span class="mode-desc">5 questions, beat your best</span>
              </button>
              <button class="trivia-mode-btn" id="btn-trivia-create-duel">
                <span class="mode-icon">âš”ï¸</span>
                <span class="mode-label">Create Duel</span>
                <span class="mode-desc">Challenge a friend</span>
              </button>
              <button class="trivia-mode-btn" id="btn-trivia-join-duel">
                <span class="mode-icon">ğŸ¤</span>
                <span class="mode-label">Join Duel</span>
                <span class="mode-desc">Enter invite code</span>
              </button>
            </div>
            <!-- 7.3: Trivia Settings -->
            <button class="trivia-settings-toggle" id="trivia-settings-toggle">
              âš™ï¸ Settings
            </button>
            <div class="trivia-settings-panel" id="trivia-settings-panel">
              <label
                >Category
                <select id="trivia-category-select">
                  <option value="" selected>All Categories</option>
                  <option value="science">Science</option>
                  <option value="history">History</option>
                  <option value="geography">Geography</option>
                  <option value="entertainment">Entertainment</option>
                  <option value="sports">Sports</option>
                </select>
              </label>
              <label
                >Difficulty
                <select id="trivia-difficulty-select">
                  <option value="">Any</option>
                  <option value="easy">Easy</option>
                  <option value="medium" selected>Medium</option>
                  <option value="hard">Hard</option>
                </select>
              </label>
            </div>
          </div>

          <!-- Play (solo & duel) -->
          <div
            id="trivia-play"
            class="card trivia-question-card"
            style="display: none"
          >
            <div class="trivia-progress" id="trivia-progress"></div>
            <div class="trivia-score-live">
              <span>Score: <strong id="trivia-score-display">0</strong></span>
              <span id="trivia-streak-display"></span>
            </div>
            <div class="trivia-timer">
              <div class="trivia-timer-bar">
                <div class="trivia-timer-fill" id="trivia-timer-fill"></div>
              </div>
              <div class="trivia-timer-text" id="trivia-timer-text">15s</div>
            </div>
            <div class="trivia-category" id="trivia-category"></div>
            <div class="trivia-q-text" id="trivia-q-text"></div>
            <div class="trivia-answers" id="trivia-answers"></div>
            <button
              class="btn btn-forfeit"
              id="btn-trivia-forfeit"
              style="display: none"
            >
              ğŸ³ï¸ Give Up
            </button>
          </div>

          <!-- Duel Create -->
          <div
            id="trivia-duel-create"
            class="card trivia-duel-panel"
            style="display: none"
          >
            <h2 style="font-size: 1.2rem; margin-bottom: 6px">
              âš”ï¸ Duel Created!
            </h2>
            <p class="text-dim" style="font-size: 0.8rem">
              Share this code with your opponent:
            </p>
            <div class="trivia-invite-code" id="duel-invite-code"></div>
            <button
              class="btn btn-secondary btn-sm"
              style="margin: 0 auto 12px; display: block"
              id="btn-duel-copy-code"
            >
              ğŸ“‹ Copy Code
            </button>
            <button
              class="btn btn-secondary btn-sm"
              style="margin: 0 auto 12px; display: block"
              id="btn-duel-voice-invite"
            >
              ğŸ™ï¸ Invite from Voice
            </button>
            <div class="trivia-duel-status">
              <span class="spinner">â³</span> Waiting for opponent...
            </div>
            <div class="trivia-countdown" id="duel-create-countdown"></div>
            <button
              class="btn btn-secondary btn-sm mt-12"
              id="btn-duel-create-cancel"
            >
              â† Cancel
            </button>
          </div>

          <!-- Duel Join -->
          <div
            id="trivia-duel-join"
            class="card trivia-duel-panel"
            style="display: none"
          >
            <h2 style="font-size: 1.2rem; margin-bottom: 12px">ğŸ¤ Join Duel</h2>
            <input
              class="trivia-duel-input"
              id="duel-join-input"
              placeholder="Enter invite code"
              maxlength="6"
            />
            <div style="display: flex; gap: 8px; margin-top: 12px">
              <button
                class="btn btn-primary btn-sm"
                style="flex: 1"
                id="btn-duel-join-submit"
              >
                Join
              </button>
              <button class="btn btn-secondary btn-sm" id="btn-duel-join-back">
                â† Back
              </button>
            </div>
          </div>

          <!-- Duel Wait -->
          <div
            id="trivia-duel-wait"
            class="card trivia-duel-panel"
            style="display: none"
          >
            <div class="trivia-duel-status">
              <span class="spinner">â³</span> Waiting for host to start...
            </div>
            <div class="trivia-countdown" id="duel-wait-countdown"></div>
            <button
              class="btn btn-secondary btn-sm mt-12"
              id="btn-duel-wait-cancel"
            >
              â† Cancel
            </button>
          </div>

          <!-- Duel Lobby (Issue 8: Ready-up) -->
          <div
            id="trivia-duel-lobby"
            class="card trivia-duel-panel"
            style="display: none"
          >
            <h2 style="font-size: 1.2rem; margin-bottom: 8px">âš”ï¸ Duel Lobby</h2>
            <p class="text-dim" style="font-size: 0.78rem; margin-bottom: 8px">
              Both players must be ready to start
            </p>
            <div class="duel-lobby-players" id="duel-lobby-players"></div>
            <button
              class="btn btn-primary mt-12"
              style="width: 100%"
              id="btn-duel-ready"
            >
              âœ… I'm Ready!
            </button>
            <div class="duel-lobby-timeout" id="duel-lobby-timeout"></div>
            <button
              class="btn btn-secondary btn-sm mt-12"
              id="btn-duel-lobby-cancel"
            >
              â† Leave
            </button>
          </div>

          <!-- Results -->
          <div id="trivia-results" class="card" style="display: none">
            <h2 style="font-size: 1.3rem">ğŸ† Results</h2>
            <div class="trivia-results-score" id="trivia-final-score">0</div>
            <div id="trivia-results-extra"></div>
            <button class="btn btn-primary mt-16" id="btn-trivia-play-again">
              ğŸ”„ Play Again
            </button>
          </div>

          <!-- Duel History (visible on trivia menu) -->
          <div
            id="trivia-duel-history"
            class="card duel-history-panel"
            style="display: none"
          >
            <h3 style="font-size: 0.95rem; margin-bottom: 8px">
              âš”ï¸ Recent Duels
            </h3>
            <div id="duel-history-list"></div>
            <div class="duel-history-pager" id="duel-history-pager"></div>
          </div>

          <!-- Duel History Bar (collapsed, shown when submenus open) -->
          <div
            id="trivia-duel-history-bar"
            class="duel-history-bar"
            style="display: none"
          >
            âš”ï¸ Recent Duels â–²
          </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€ BUILDING BLOX SCREEN â”€â”€â”€â”€â”€â”€ -->
        <section class="screen" id="screen-blox">
          <div class="screen-header">
            <h1>ğŸ§± Building Blox</h1>
            <div class="subtitle">Block Puzzle â€¢ Clear Lines</div>
          </div>

          <div class="stats-bar">
            <div class="stat">
              <div class="stat-value text-gold" id="blox-score">0</div>
              <div class="stat-label">ğŸ† Score</div>
            </div>
            <div class="stat">
              <div class="stat-value" style="color: #06b6d4" id="blox-lines">
                0
              </div>
              <div class="stat-label">ğŸ“Š Lines</div>
            </div>
            <div class="stat">
              <div class="stat-value" style="color: #a78bfa" id="blox-best">
                0
              </div>
              <div class="stat-label">ğŸ† Best</div>
            </div>
            <div class="stat">
              <div class="stat-value text-gold" id="blox-reward">â€”</div>
              <div class="stat-label">ğŸª™ Gold</div>
            </div>
          </div>

          <div class="blox-main">
            <!-- Leaderboard Panel (v4.9: always visible, glassmorphism) -->
            <div class="blox-lb-panel" id="blox-lb-panel">
              <div class="blox-lb-title">ğŸ† Leaderboard</div>
              <div class="blox-lb-tabs">
                <button
                  class="blox-lb-tab active"
                  data-scope="global"
                  id="blox-lb-tab-all"
                >
                  All
                </button>
                <button
                  class="blox-lb-tab"
                  data-scope="room"
                  id="blox-lb-tab-room"
                >
                  Voice
                </button>
              </div>
              <table class="blox-lb-table">
                <tbody id="blox-lb-body">
                  <tr>
                    <td colspan="3" class="blox-lb-empty">No scores yet</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="blox-layout">
              <div class="blox-board" id="blox-board"></div>
              <div class="blox-tray" id="blox-tray"></div>
              <!-- Pause / Welcome overlay -->
              <div class="blox-pause-overlay show" id="blox-pause-overlay">
                <div class="blox-pause-card">
                  <div class="blox-pause-title" id="blox-pause-title">
                    ğŸ§± Building Blox
                  </div>
                  <button class="btn btn-primary" id="blox-btn-new">
                    ğŸ§± New Game
                  </button>
                  <button
                    class="btn btn-secondary"
                    id="blox-btn-resume"
                    style="display: none"
                  >
                    â–¶ Continue
                  </button>
                  <button
                    class="btn btn-danger"
                    id="blox-btn-end"
                    style="display: none"
                  >
                    ğŸ End Game
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Game Over Overlay -->
          <div class="overlay" id="blox-overlay">
            <div class="overlay-card overlay-gameover">
              <h2>ğŸ† Game Over</h2>
              <div class="overlay-score" id="blox-final-score">0</div>
              <div class="overlay-detail">
                Lines:
                <strong class="text-accent" id="blox-final-lines">0</strong>
              </div>
              <div class="overlay-detail" style="margin-bottom: 20px">
                Best:
                <strong class="text-accent" id="blox-final-best">0</strong>
              </div>
              <button class="btn btn-primary" id="btn-blox-play-again">
                ğŸ”„ Play Again
              </button>
            </div>
          </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€ FARM SCREEN â”€â”€â”€â”€â”€â”€ -->
        <section class="screen" id="screen-farm">
          <div class="screen-header">
            <h1>ğŸŒ± Cozy Farm</h1>
            <div class="subtitle">Plant â€¢ Grow â€¢ Harvest</div>
          </div>

          <div class="stats-bar">
            <div class="stat">
              <div class="stat-value text-gold" id="farm-coins">200</div>
              <div class="stat-label">ğŸª™ Coins</div>
            </div>
            <div class="stat">
              <div class="stat-value text-accent" id="farm-xp">0</div>
              <div class="stat-label">â­ XP</div>
            </div>
            <div class="stat">
              <div class="stat-value text-success" id="farm-level">Lv1</div>
              <div class="stat-label">ğŸ… Level</div>
            </div>
          </div>

          <!-- Farm Main Content: plots + side panel -->
          <div class="farm-layout">
            <div class="farm-plots" id="farm-plots"></div>

            <div class="farm-panel" id="farm-panel">
              <div class="farm-panel-tabs">
                <button
                  class="farm-tab active"
                  id="farm-tab-inv"
                  data-tab="inv"
                >
                  ğŸ“¦ Inventory
                </button>
                <button class="farm-tab" id="farm-tab-shop" data-tab="shop">
                  ğŸŒ¾ Shop
                </button>
              </div>

              <!-- Inventory Tab -->
              <div class="farm-tab-content active" id="farm-tab-content-inv">
                <div class="farm-inventory-grid" id="farm-inventory-grid">
                  <div class="farm-inv-empty">No crops harvested yet</div>
                </div>
              </div>

              <!-- Shop Tab -->
              <div class="farm-tab-content" id="farm-tab-content-shop">
                <div
                  class="farm-buy-bar"
                  id="farm-buy-bar"
                  style="display: none"
                ></div>
                <div class="farm-shop-grid" id="farm-shop-grid"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€ MATCH-3 SCREEN â”€â”€â”€â”€â”€â”€ -->
        <section class="screen" id="screen-match3">
          <div class="screen-header">
            <h1>ğŸ’ Gem Crush</h1>
            <div class="subtitle">Match-3 Puzzle</div>
          </div>

          <div class="stats-bar">
            <div class="stat">
              <div class="stat-value text-gold" id="m3-score">0</div>
              <div class="stat-label">ğŸ† Score</div>
            </div>
            <div class="stat">
              <div class="stat-value" style="color: #60a5fa" id="m3-moves">
                30
              </div>
              <div class="stat-label" id="m3-moves-label">Moves</div>
            </div>
            <div class="stat">
              <div class="stat-value" style="color: #f472b6" id="m3-combo">
                â€”
              </div>
              <div class="stat-label">ğŸ”¥ Combo</div>
            </div>
            <div class="stat">
              <div class="stat-value text-accent" id="m3-best">0</div>
              <div class="stat-label">ğŸ† Best</div>
            </div>
            <div class="stat">
              <div class="stat-value text-gold" id="m3-gold">â€”</div>
              <div class="stat-label">ğŸª™ Reward</div>
            </div>
          </div>

          <div class="m3-layout">
            <div class="m3-main">
              <div class="m3-board-container" id="m3-board-container">
                <div class="m3-board" id="m3-board"></div>
                <div class="m3-combo-banner" id="m3-combo-banner"></div>
              </div>

              <div style="display: flex; gap: 10px; margin-top: 16px">
                <button class="btn btn-primary" id="m3-btn-start">
                  ğŸ® New Game
                </button>
                <button class="btn btn-secondary m3-lb-toggle" id="m3-btn-lb">
                  ğŸ† Leaderboard
                </button>
              </div>

              <!-- Leaderboard Panel (v4.12.2: always-visible right side, mirrors Blox left) -->
              <div class="m3-lb-panel" id="m3-lb-panel">
                <div class="m3-lb-title">ğŸ† Leaderboard</div>
                <div class="m3-lb-tabs">
                  <button
                    class="m3-lb-tab active"
                    data-scope="global"
                    id="btn-lb-tab-all"
                  >
                    All
                  </button>
                  <button
                    class="m3-lb-tab"
                    data-scope="room"
                    id="btn-lb-tab-room"
                  >
                    Voice
                  </button>
                </div>
                <table class="m3-lb-table">
                  <tbody id="m3-lb-body">
                    <tr>
                      <td colspan="3" class="m3-lb-empty">No scores yet ğŸ†</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Pause / Continue Overlay (mirrors Blox pattern) -->
          <div class="overlay" id="m3-pause-overlay">
            <div class="overlay-card overlay-pause">
              <h2 id="m3-pause-title">ğŸ’ Gem Crush</h2>
              <div class="overlay-actions">
                <button class="btn btn-primary" id="m3-pause-resume">
                  â–¶ï¸ Continue
                </button>
                <button class="btn btn-secondary" id="m3-pause-new">
                  ğŸ® New Game
                </button>
                <button
                  class="btn btn-muted"
                  id="m3-pause-end"
                  style="display: none"
                >
                  ğŸ›‘ End Game
                </button>
              </div>
            </div>
          </div>

          <!-- Game Over Overlay -->
          <div class="overlay" id="m3-overlay">
            <div class="overlay-card overlay-gameover">
              <h2>ğŸ† Game Over</h2>
              <div class="overlay-score" id="m3-final-score">0</div>
              <div class="overlay-detail" style="margin-bottom: 20px">
                Best: <strong class="text-accent" id="m3-final-best">0</strong>
              </div>
              <div
                id="m3-new-record"
                style="
                  display: none;
                  font-size: 1.1rem;
                  font-weight: 700;
                  color: #fbbf24;
                  margin-bottom: 12px;
                  animation: goldFloat 2s ease infinite alternate;
                "
              >
                ğŸ‰ New Record!
              </div>
              <button class="btn btn-primary" id="btn-m3-dismiss">âœ… OK</button>
            </div>
          </div>
        </section>
      </div>
      <!-- /screen-track -->
    </div>
    <!-- /viewport -->

    <!-- â•â•â• Nav Arrows (desktop: glassmorphic edge strips, after viewport for CSS ~) â•â•â• -->
    <!-- â•â•â• Pet Companion Overlay â•â•â• -->
    <div class="pet-overlay dock-ground" id="pet-overlay">
      <div class="pet-container state-idle" id="pet-container">
        <div class="pet-sprite" id="pet-sprite">ğŸ•</div>
        <div class="pet-hearts" id="pet-hearts"></div>
      </div>
    </div>
    <div class="pet-info-panel" id="pet-info-panel" style="display: none"></div>

    <!-- â•â•â• Quick-Feed Energy Modal â•â•â• -->
    <div class="overlay" id="energy-modal">
      <div
        class="overlay-card overlay-energy"
        style="text-align: center; max-width: 340px"
      >
        <h2 style="margin: 0 0 6px">âš¡ Not Enough Energy</h2>
        <p
          class="text-dim"
          id="energy-modal-desc"
          style="margin: 0 0 12px; font-size: 0.85rem"
        >
          Feed your pet to restore energy!
        </p>
        <div
          id="energy-modal-items"
          style="max-height: 200px; overflow-y: auto"
        ></div>
        <div
          id="energy-modal-play"
          style="display: none; margin-top: 10px"
        ></div>
        <div style="margin-top: 12px; display: flex; gap: 8px">
          <button
            class="btn btn-secondary btn-sm"
            id="energy-modal-farm"
            style="flex: 1"
          >
            ğŸŒ¾ Go to Farm
          </button>
          <button
            class="btn btn-secondary btn-sm"
            id="energy-modal-close"
            style="flex: 1"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <button class="nav-arrow nav-left" id="nav-left">â€¹</button>
    <button class="nav-arrow nav-right" id="nav-right">â€º</button>

    <!-- â•â•â• Version Badge â•â•â• -->
    <div
      id="version-badge"
      style="
        position: fixed;
        bottom: 4px;
        right: 6px;
        font-size: 0.55rem;
        color: rgba(255, 255, 255, 0.18);
        pointer-events: none;
        z-index: 999;
        font-family: monospace;
      "
    >
      {{APP_VERSION}}
    </div>

    <!-- v4.6: Server injects window.__APP_VERSION__ here -->
    <!--APP_VERSION_INJECT-->

    <!-- â•â•â• Scripts (shared.js loads game scripts dynamically via SmartLoader) â•â•â• -->
    <script src="js/discord-sdk.js"></script>
    <script src="js/store.js?v=4.9"></script>
    <script src="js/hud.js?v=4.9"></script>
    <script src="js/pet.js?v=4.9"></script>
    <script src="js/shared.js?v=4.9"></script>
  </body>
</html>
