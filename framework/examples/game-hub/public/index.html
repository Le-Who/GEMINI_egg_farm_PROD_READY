<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸ® Game Hub â€” Farm + Trivia + Match-3</title>
    <meta
      name="description"
      content="Unified Game Hub: Farm, Trivia (Solo & Duel), Match-3 with Leaderboard â€” Discord Activities Framework Demo"
    />
    <link rel="stylesheet" href="css/base.css?v=3.1" />
    <link rel="stylesheet" href="css/farm.css?v=3.1" />
    <link rel="stylesheet" href="css/trivia.css?v=3.1" />
    <link rel="stylesheet" href="css/match3.css?v=3.1" />
    <link rel="stylesheet" href="css/hud.css?v=3.1" />
    <link rel="stylesheet" href="css/pet.css?v=3.1" />
  </head>
  <body>
    <!-- â•â•â• Boot Loading Overlay â•â•â• -->
    <div class="boot-loader" id="boot-loader">
      <div class="boot-spinner"></div>
      <div class="boot-text">Loading Game Hubâ€¦</div>
    </div>

    <!-- â•â•â• Nav Dots (mobile: top center) â•â•â• -->
    <div class="nav-dots">
      <button class="nav-dot" id="nav-dot-trivia" title="Trivia"></button>
      <button class="nav-dot active" id="nav-dot-farm" title="Farm"></button>
      <button class="nav-dot" id="nav-dot-match3" title="Match-3"></button>
    </div>
    <!-- Farm ready badge (Issue 7) -->
    <span class="farm-ready-badge" id="farm-ready-badge"></span>

    <!-- â•â•â• TopHUD â€” Energy & Gold â•â•â• -->
    <div class="top-hud" id="top-hud">
      <div class="hud-energy" id="hud-energy">
        <!-- Bug 7: regen fill behind content, fills entire energy pill -->
        <div
          class="hud-energy-regen-fill"
          id="hud-energy-regen-fill"
          style="width: 0%"
        ></div>
        <span class="hud-icon">âš¡</span>
        <span id="hud-energy-text">--/--</span>
        <div class="hud-energy-tooltip" id="hud-energy-tooltip">Loading...</div>
      </div>
      <div class="hud-gold" id="hud-gold">
        <span class="hud-icon">ğŸª™</span>
        <span id="hud-gold-text">--</span>
      </div>
    </div>

    <!-- â•â•â• Viewport â•â•â• -->
    <div class="viewport">
      <div class="screen-track" id="track">
        <!-- â”€â”€â”€â”€â”€â”€ TRIVIA SCREEN â”€â”€â”€â”€â”€â”€ -->
        <section class="screen" id="screen-trivia">
          <div class="screen-header">
            <h1>ğŸ§  Brain Blitz</h1>
            <div class="subtitle">Trivia â€” Solo & Duel</div>
          </div>

          <!-- Menu -->
          <div id="trivia-menu" class="card">
            <div class="trivia-modes">
              <button class="trivia-mode-btn" id="btn-trivia-solo">
                <span class="mode-icon">ğŸ¯</span>
                <span class="mode-label">Solo</span>
                <span class="mode-desc">5 questions, beat your best</span>
              </button>
              <button class="trivia-mode-btn" id="btn-trivia-create-duel">
                <span class="mode-icon">âš”ï¸</span>
                <span class="mode-label">Create Duel</span>
                <span class="mode-desc">Challenge a friend</span>
              </button>
              <button class="trivia-mode-btn" id="btn-trivia-join-duel">
                <span class="mode-icon">ğŸ¤</span>
                <span class="mode-label">Join Duel</span>
                <span class="mode-desc">Enter invite code</span>
              </button>
            </div>
          </div>

          <!-- Play (solo & duel) -->
          <div
            id="trivia-play"
            class="card trivia-question-card"
            style="display: none"
          >
            <div class="trivia-progress" id="trivia-progress"></div>
            <div class="trivia-score-live">
              <span>Score: <strong id="trivia-score-display">0</strong></span>
              <span id="trivia-streak-display"></span>
            </div>
            <div class="trivia-timer">
              <div class="trivia-timer-bar">
                <div class="trivia-timer-fill" id="trivia-timer-fill"></div>
              </div>
              <div class="trivia-timer-text" id="trivia-timer-text">15s</div>
            </div>
            <div class="trivia-category" id="trivia-category"></div>
            <div class="trivia-q-text" id="trivia-q-text"></div>
            <div class="trivia-answers" id="trivia-answers"></div>
            <button
              class="btn btn-forfeit"
              id="btn-trivia-forfeit"
              style="display: none"
            >
              ğŸ³ï¸ Give Up
            </button>
          </div>

          <!-- Duel Create -->
          <div
            id="trivia-duel-create"
            class="card trivia-duel-panel"
            style="display: none"
          >
            <h2 style="font-size: 1.2rem; margin-bottom: 6px">
              âš”ï¸ Duel Created!
            </h2>
            <p class="text-dim" style="font-size: 0.8rem">
              Share this code with your opponent:
            </p>
            <div class="trivia-invite-code" id="duel-invite-code"></div>
            <button
              class="btn btn-secondary btn-sm"
              style="margin: 0 auto 12px; display: block"
              id="btn-duel-copy-code"
            >
              ğŸ“‹ Copy Code
            </button>
            <button
              class="btn btn-secondary btn-sm"
              style="margin: 0 auto 12px; display: block"
              id="btn-duel-voice-invite"
            >
              ğŸ™ï¸ Invite from Voice
            </button>
            <div class="trivia-duel-status">
              <span class="spinner">â³</span> Waiting for opponent...
            </div>
            <div class="trivia-countdown" id="duel-create-countdown"></div>
            <button
              class="btn btn-secondary btn-sm mt-12"
              id="btn-duel-create-cancel"
            >
              â† Cancel
            </button>
          </div>

          <!-- Duel Join -->
          <div
            id="trivia-duel-join"
            class="card trivia-duel-panel"
            style="display: none"
          >
            <h2 style="font-size: 1.2rem; margin-bottom: 12px">ğŸ¤ Join Duel</h2>
            <input
              class="trivia-duel-input"
              id="duel-join-input"
              placeholder="Enter invite code"
              maxlength="6"
            />
            <div style="display: flex; gap: 8px; margin-top: 12px">
              <button
                class="btn btn-primary btn-sm"
                style="flex: 1"
                id="btn-duel-join-submit"
              >
                Join
              </button>
              <button class="btn btn-secondary btn-sm" id="btn-duel-join-back">
                â† Back
              </button>
            </div>
          </div>

          <!-- Duel Wait -->
          <div
            id="trivia-duel-wait"
            class="card trivia-duel-panel"
            style="display: none"
          >
            <div class="trivia-duel-status">
              <span class="spinner">â³</span> Waiting for host to start...
            </div>
            <div class="trivia-countdown" id="duel-wait-countdown"></div>
            <button
              class="btn btn-secondary btn-sm mt-12"
              id="btn-duel-wait-cancel"
            >
              â† Cancel
            </button>
          </div>

          <!-- Duel Lobby (Issue 8: Ready-up) -->
          <div
            id="trivia-duel-lobby"
            class="card trivia-duel-panel"
            style="display: none"
          >
            <h2 style="font-size: 1.2rem; margin-bottom: 8px">âš”ï¸ Duel Lobby</h2>
            <p class="text-dim" style="font-size: 0.78rem; margin-bottom: 8px">
              Both players must be ready to start
            </p>
            <div class="duel-lobby-players" id="duel-lobby-players"></div>
            <button
              class="btn btn-primary mt-12"
              style="width: 100%"
              id="btn-duel-ready"
            >
              âœ… I'm Ready!
            </button>
            <div class="duel-lobby-timeout" id="duel-lobby-timeout"></div>
            <button
              class="btn btn-secondary btn-sm mt-12"
              id="btn-duel-lobby-cancel"
            >
              â† Leave
            </button>
          </div>

          <!-- Results -->
          <div id="trivia-results" class="card" style="display: none">
            <h2 style="font-size: 1.3rem">ğŸ† Results</h2>
            <div class="trivia-results-score" id="trivia-final-score">0</div>
            <div id="trivia-results-extra"></div>
            <button class="btn btn-primary mt-16" id="btn-trivia-play-again">
              ğŸ”„ Play Again
            </button>
          </div>

          <!-- Duel History (visible on trivia menu) -->
          <div
            id="trivia-duel-history"
            class="card duel-history-panel"
            style="display: none"
          >
            <h3 style="font-size: 0.95rem; margin-bottom: 8px">
              âš”ï¸ Recent Duels
            </h3>
            <div id="duel-history-list"></div>
            <div class="duel-history-pager" id="duel-history-pager"></div>
          </div>

          <!-- Duel History Bar (collapsed, shown when submenus open) -->
          <div
            id="trivia-duel-history-bar"
            class="duel-history-bar"
            style="display: none"
          >
            âš”ï¸ Recent Duels â–²
          </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€ FARM SCREEN â”€â”€â”€â”€â”€â”€ -->
        <section class="screen" id="screen-farm">
          <div class="screen-header">
            <h1>ğŸŒ± Cozy Farm</h1>
            <div class="subtitle">Plant â€¢ Grow â€¢ Harvest</div>
          </div>

          <div class="stats-bar">
            <div class="stat">
              <div class="stat-value text-gold" id="farm-coins">200</div>
              <div class="stat-label">Coins</div>
            </div>
            <div class="stat">
              <div class="stat-value text-accent" id="farm-xp">0</div>
              <div class="stat-label">XP</div>
            </div>
            <div class="stat">
              <div class="stat-value text-success" id="farm-level">Lv1</div>
              <div class="stat-label">Level</div>
            </div>
          </div>

          <!-- Farm Main Content: plots + side panel -->
          <div class="farm-layout">
            <div class="farm-plots" id="farm-plots"></div>

            <div class="farm-panel" id="farm-panel">
              <div class="farm-panel-tabs">
                <button
                  class="farm-tab active"
                  id="farm-tab-inv"
                  data-tab="inv"
                >
                  ğŸ“¦ Inventory
                </button>
                <button class="farm-tab" id="farm-tab-shop" data-tab="shop">
                  ğŸŒ¾ Shop
                </button>
              </div>

              <!-- Inventory Tab -->
              <div class="farm-tab-content active" id="farm-tab-content-inv">
                <div class="farm-inventory-grid" id="farm-inventory-grid">
                  <div class="farm-inv-empty">No crops harvested yet</div>
                </div>
              </div>

              <!-- Shop Tab -->
              <div class="farm-tab-content" id="farm-tab-content-shop">
                <div
                  class="farm-buy-bar"
                  id="farm-buy-bar"
                  style="display: none"
                ></div>
                <div class="farm-shop-grid" id="farm-shop-grid"></div>
              </div>
            </div>
          </div>
        </section>

        <!-- â”€â”€â”€â”€â”€â”€ MATCH-3 SCREEN â”€â”€â”€â”€â”€â”€ -->
        <section class="screen" id="screen-match3">
          <div class="screen-header">
            <h1>ğŸ’ Gem Crush</h1>
            <div class="subtitle">Match-3 Puzzle</div>
          </div>

          <div class="stats-bar">
            <div class="stat">
              <div class="stat-value text-gold" id="m3-score">0</div>
              <div class="stat-label">Score</div>
            </div>
            <div class="stat">
              <div class="stat-value" style="color: #60a5fa" id="m3-moves">
                30
              </div>
              <div class="stat-label" id="m3-moves-label">Moves</div>
            </div>
            <div class="stat">
              <div class="stat-value" style="color: #f472b6" id="m3-combo">
                â€”
              </div>
              <div class="stat-label">Combo</div>
            </div>
            <div class="stat">
              <div class="stat-value text-accent" id="m3-best">0</div>
              <div class="stat-label">Best</div>
            </div>
            <div class="stat">
              <div class="stat-value text-gold" id="m3-gold">â€”</div>
              <div class="stat-label">ğŸª™ Reward</div>
            </div>
          </div>

          <div class="m3-layout">
            <div class="m3-main">
              <div class="m3-board-container" id="m3-board-container">
                <div class="m3-board" id="m3-board"></div>
                <div class="m3-combo-banner" id="m3-combo-banner"></div>
              </div>

              <div style="display: flex; gap: 10px; margin-top: 16px">
                <button class="btn btn-primary" id="m3-btn-start">
                  ğŸ® New Game
                </button>
                <button class="btn btn-secondary" id="m3-btn-lb">
                  ğŸ† Leaderboard
                </button>
              </div>
            </div>

            <!-- Leaderboard Backdrop (narrow screens) -->
            <div class="m3-lb-backdrop" id="m3-lb-backdrop"></div>

            <!-- Leaderboard Panel (slide-in on narrow, side-by-side on wide) -->
            <div class="m3-lb-panel" id="m3-lb-panel">
              <button class="m3-lb-close" id="m3-lb-close" title="Close">
                âœ•
              </button>
              <div class="m3-lb-tabs">
                <button class="m3-lb-tab active" id="btn-lb-tab-all">
                  ğŸŒ All Players
                </button>
                <button class="m3-lb-tab" id="btn-lb-tab-room">
                  ğŸ™ï¸ Voice Channel
                </button>
              </div>
              <table class="m3-lb-table">
                <thead>
                  <tr>
                    <th>Rank</th>
                    <th>Player</th>
                    <th style="text-align: right">Score</th>
                  </tr>
                </thead>
                <tbody id="m3-lb-body">
                  <tr>
                    <td colspan="3" class="m3-lb-empty">No scores yet ğŸ†</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Game Over Overlay -->
          <div class="overlay" id="m3-overlay">
            <div class="overlay-card">
              <h2>ğŸ† Game Over</h2>
              <div
                style="
                  font-size: 2.5rem;
                  font-weight: 900;
                  color: var(--gold);
                  margin: 10px 0;
                "
                id="m3-final-score"
              >
                0
              </div>
              <div
                style="
                  font-size: 0.85rem;
                  color: var(--text-dim);
                  margin-bottom: 20px;
                "
              >
                Best: <strong class="text-accent" id="m3-final-best">0</strong>
              </div>
              <button class="btn btn-primary" id="btn-m3-play-again">
                ğŸ”„ Play Again
              </button>
            </div>
          </div>
        </section>
      </div>
      <!-- /screen-track -->
    </div>
    <!-- /viewport -->

    <!-- â•â•â• Nav Arrows (desktop: glassmorphic edge strips, after viewport for CSS ~) â•â•â• -->
    <!-- â•â•â• Pet Companion Overlay â•â•â• -->
    <div class="pet-overlay dock-ground" id="pet-overlay">
      <div class="pet-container state-idle" id="pet-container">
        <div class="pet-sprite" id="pet-sprite">ğŸ•</div>
        <div class="pet-hearts" id="pet-hearts"></div>
      </div>
    </div>
    <div class="pet-info-panel" id="pet-info-panel" style="display: none"></div>

    <!-- â•â•â• Quick-Feed Energy Modal â•â•â• -->
    <div class="overlay" id="energy-modal">
      <div class="overlay-card" style="text-align: center; max-width: 340px">
        <h2 style="margin: 0 0 6px">âš¡ Not Enough Energy</h2>
        <p
          class="text-dim"
          id="energy-modal-desc"
          style="margin: 0 0 12px; font-size: 0.85rem"
        >
          Feed your pet to restore energy!
        </p>
        <div
          id="energy-modal-items"
          style="max-height: 200px; overflow-y: auto"
        ></div>
        <div
          id="energy-modal-play"
          style="display: none; margin-top: 10px"
        ></div>
        <div style="margin-top: 12px; display: flex; gap: 8px">
          <button
            class="btn btn-secondary btn-sm"
            id="energy-modal-farm"
            style="flex: 1"
          >
            ğŸŒ¾ Go to Farm
          </button>
          <button
            class="btn btn-secondary btn-sm"
            id="energy-modal-close"
            style="flex: 1"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <button class="nav-arrow nav-left" id="nav-left">â€¹</button>
    <button class="nav-arrow nav-right" id="nav-right">â€º</button>

    <!-- â•â•â• Version Badge â•â•â• -->
    <div
      id="version-badge"
      style="
        position: fixed;
        bottom: 4px;
        right: 6px;
        font-size: 0.55rem;
        color: rgba(255, 255, 255, 0.18);
        pointer-events: none;
        z-index: 999;
        font-family: monospace;
      "
    >
      v3.1
    </div>

    <!-- â•â•â• Scripts (shared.js loads game scripts dynamically via SmartLoader) â•â•â• -->
    <script src="js/discord-sdk.js"></script>
    <script src="js/store.js?v=3.1"></script>
    <script src="js/hud.js?v=3.1"></script>
    <script src="js/pet.js?v=3.1"></script>
    <script src="js/shared.js?v=3.1"></script>
  </body>
</html>
